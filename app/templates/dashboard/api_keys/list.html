{% extends "base.html" %}

{% block title %}API Keys - Social Card Service{% endblock %}

{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h2>API Keys</h2>
    </div>

    {% if new_key %}
    <div class="api-key-warning">
        <strong>Important!</strong> Copy your API key now. It won't be shown again.
    </div>
    <div class="api-key-display">
        {{ new_key }}
    </div>
    <button onclick="navigator.clipboard.writeText('{{ new_key }}')" class="btn btn-primary">Copy to Clipboard</button>
    {% endif %}

    <div class="create-key-form">
        <h3>Create New API Key</h3>
        <form method="POST" action="{{ url_for('dashboard.api_keys_create') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-group">
                <input type="text" name="name" placeholder="Key name (e.g., 'Production', 'Testing')" required maxlength="100" class="form-control">
            </div>
            <button type="submit" class="btn btn-primary">Create Key</button>
        </form>
    </div>

    {% if keys %}
    <h3>Your API Keys</h3>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Key</th>
                <th>Created</th>
                <th>Last Used</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for key in keys %}
            <tr>
                <td>{{ key.name }}</td>
                <td><code>{{ key.key_prefix }}...</code></td>
                <td>{{ key.created_at.strftime('%Y-%m-%d') }}</td>
                <td>{{ key.last_used_at.strftime('%Y-%m-%d %H:%M') if key.last_used_at else 'Never' }}</td>
                <td>
                    {% if key.is_active %}
                    <span class="status-active">Active</span>
                    {% else %}
                    <span class="status-revoked">Revoked</span>
                    {% endif %}
                </td>
                <td>
                    {% if key.is_active %}
                    <form action="{{ url_for('dashboard.api_keys_revoke', key_id=key.id) }}" method="POST" style="display:inline" onsubmit="return confirm('Are you sure you want to revoke this key? This cannot be undone.')">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="btn btn-danger btn-small">Revoke</button>
                    </form>
                    {% else %}
                    -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>You haven't created any API keys yet.</p>
    </div>
    {% endif %}

    <div class="api-docs">
        <h3>API Usage</h3>
        <p>Include your API key in the <code>X-API-Key</code> header:</p>
        <pre>curl -X POST {{ config.BASE_URL }}/api/v1/cards \
  -H "X-API-Key: YOUR_API_KEY" \
  -F "image=@image.png" \
  -F "title=My Card" \
  -F "destination_url=https://example.com"</pre>
    </div>
</div>
{% endblock %}
